<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NU Solar Software Team Training - Fall 2023</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="purpose.html"><strong aria-hidden="true">1.</strong> Our purpose</a></li><li class="chapter-item expanded affix "><li class="part-title">A Telemetry Pipeline</li><li class="chapter-item expanded "><a href="pipeline/step-0/index.html"><strong aria-hidden="true">2.</strong> Current in a wire</a></li><li class="chapter-item expanded "><a href="pipeline/step-1/index.html"><strong aria-hidden="true">3.</strong> A stream of bytes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pipeline/step-1/representing-data.html"><strong aria-hidden="true">3.1.</strong> Representing data</a></li><li class="chapter-item expanded "><a href="pipeline/step-1/can-frames.html"><strong aria-hidden="true">3.2.</strong> CAN frames</a></li><li class="chapter-item expanded "><a href="pipeline/step-1/exercise.html"><strong aria-hidden="true">3.3.</strong> Exercise - Thinking like a computer</a></li></ol></li><li class="chapter-item expanded "><a href="pipeline/step-2/index.html"><strong aria-hidden="true">4.</strong> An object in memory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pipeline/step-2/python/index.html"><strong aria-hidden="true">4.1.</strong> The Python programming language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pipeline/step-2/python/setting-up.html"><strong aria-hidden="true">4.1.1.</strong> Setting up</a></li><li class="chapter-item expanded "><a href="pipeline/step-2/python/basics.html"><strong aria-hidden="true">4.1.2.</strong> Basics</a></li></ol></li><li class="chapter-item expanded "><a href="pipeline/step-2/exercise.html"><strong aria-hidden="true">4.2.</strong> Exercise - An automated autopsy</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> A row in a table</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> SQL</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.1.</strong> Setting up</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.2.</strong> Basics</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> Exercise - Persistence is key</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> A packet in a network</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> A stream of bytes, revisited</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Exercise - Parsing from a distance</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tools</li><li class="chapter-item expanded "><a href="tools/command-line.html"><strong aria-hidden="true">7.</strong> The command line</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Git and GitHub</div></li><li class="chapter-item expanded affix "><li class="part-title">The Telemetry System</li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Data flow</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Data visualization</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> Onboard Display</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.2.</strong> Base station dashboard</div></li></ol></li><li class="chapter-item expanded "><a href="system/goals.html"><strong aria-hidden="true">11.</strong> Goals</a></li><li class="chapter-item expanded affix "><li class="part-title">Hardware Reference</li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> CANUSB COM FD</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Raspberry Pi 4</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> PiCAN 2</div></li><li class="chapter-item expanded "><a href="hardware/wavesculptor22.html"><strong aria-hidden="true">15.</strong> Tritium WaveSculptor 22 Motor Controller</a></li><li class="chapter-item expanded "><a href="hardware/driver-controls.html"><strong aria-hidden="true">16.</strong> Prohelion EV Driver Controls</a></li><li class="chapter-item expanded "><a href="hardware/mppt.html"><strong aria-hidden="true">17.</strong> Elmar Solar MPPT</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Digi XBee® SX 1-Watt 900 MHz RF</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NU Solar Software Team Training - Fall 2023</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to the Northwestern Solar Car Software team!</p>
<p><img src="images/NU-SOLAR.jpeg" alt="NU Solar" /></p>
<div style="text-align: center"><i>SC7s at the 2023 Formula Sun Grand Prix</i></div>
<p>This handbook contains training tutorials and documentation for Fall 2023.
Training will roughly follow the chapters in this book as they appear, but
we may jump between sections as needed. There may be more information here
than gets covered explicitly during training sessions; the goal is for this
handbook to a be a valuable reference for new members.</p>
<h2 id="training-road-map"><a class="header" href="#training-road-map">Training Road Map</a></h2>
<p>There's a lot to learn about our telemetry system—but don't worry! This
handbook assumes no prior programming experience or familiarity with the
hardware we use. Generally, many new members do enter with some programming
background, so we may move faster through some chapters in practice.</p>
<p>As part of this training, you'll build a simple pipeline for processing
telemetry data from our solar car. You'll construct this pipeline from the
ground up, understanding each step in the life cycle of a given piece of data.</p>
<ul>
<li>First, you'll learn about the CAN standard for device communication on
automobiles. At this level, telemetry data is electrical traffic on a network
of wires.</li>
<li>Next, you'll work with different data representations and try your hand
at manually parsing collections of bytes known as CAN frames.</li>
<li>With that done, you'll automate the CAN parsing process with Python. At
this point, telemetry data exists as objects in memory.</li>
<li>Next, you'll learn how to persist data in an SQL database for long term
storage.</li>
<li>Finally, you'll adapt your pipeline to receive data over an XBee radio
network.</li>
</ul>
<p>Along the way, you'll pick up some skills applicable to programming in general,
including working on the command line, developing remotely with SSH, using
Git to collaborate with others, organizing code with virtual environments,
working with package managers, and more. </p>
<p>We'll end the training with an introduction to the current telemetry system
and the projects we have planned for this year.</p>
<p>Training is expected to last roughly a month, but may be shorter or longer
depending on member feedback. Simultaneous to training sessions following
this handbook, more &quot;hands-on&quot; meetings will be taking place to introduce
new members to the telemetry system in action.</p>
<h2 id="getting-help"><a class="header" href="#getting-help">Getting Help</a></h2>
<p>Software is a small team, and every member should feel welcome and comfortable
contributing to the project. If you have any concerns about training or the team
in general, please reach out to Matthew Sinclair (Software Lead), Alexander
Sorensen (Project Lead), or any other member of the solar car team. New members
are the future of this organization, and we all want you to succeed!</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Want to add something to this handbook? The files for this site are publicly
available at
<a href="https://github.com/nusolar/training-f23">github.com/nusolar/training-f23</a>.
Submit a pull request with your proposed changes (see the
<a href="tools/git.html">Git and GitHub</a> chapter to learn how).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="our-purpose"><a class="header" href="#our-purpose">Our purpose</a></h1>
<p>The Software team's main responsibility is to monitor telemetry data coming
from the solar car, including, for example, the state of charge for cells in the
battery box, the amount of current being delivered to the MPPTs, the temperature
in the motor controllers, and much more. While Mechanical and Electrical are the
teams that actively build the car's structure and its circuitry, Software's
role is nevertheless fundamental. By tracking telemetry data, we allow the
team to:</p>
<ul>
<li>Diagnose issues with the electrical components on the car during development.</li>
<li>Monitor relevant information during a race both from a remote dashboard and an onboard
display.</li>
<li>Predict failure and investigate their causes when they occur.</li>
<li>Persist telemetry signals in a database for later analysis.</li>
<li>Make more informed decisions about race strategy and future design cycles.</li>
</ul>
<br/>
<p><img src="images/dashboard.png" alt="Dashboard" /></p>
<div style="text-align: center"><i>A basic telemetry dashboard</i></div>
<p>In the next chapter, you'll start the process of building a simple telemetry
processing pipeline from scratch.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="current-in-a-wire"><a class="header" href="#current-in-a-wire">Current in a wire</a></h1>
<p>At the most fundamental level, telemetry data exists as electrical signals propagating
through a circuit. The exact way that wires are composed with resistors, batteries,
motor controllers, MPPTs, etc. in a way that makes our solar car function is complex,
but it's largely the domain of the Electrical team.</p>
<br />
<p><img src="pipeline/step-0/../../images/car-internals.jpg" alt="SC7s internals" /></p>
<div style="text-align: center"><i>SC7s internals</i></div>
<p>Much of the details at this level are not essential for the Software team to know,
but two facts are particularly relevant:</p>
<ol>
<li>There exists a circuit in the solar car on which all the electrical devices are
connected and communicate, and traffic on this circuit can be monitored. This is
the <em>raison d'être</em> of the Software team; our job is fundamentally based on
processing this traffic.</li>
<li>This circuit follows the Controller Area Network (CAN bus) standard, which is
a protocol commonly used in automobiles. The protocol defines certain electrical
properties (e.g. the characteristic impedance of the transmission line) that,
when met, allow devices on the network to communicate with minimal errors and
noise. Again, this is largely Electrical's domain, but what's important for
Software is the format of messages sent on this line. Before we get into that
though (see <a href="pipeline/step-0/../step-1/can-frames.html">CAN frames</a>), we need to introduce data
representations.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="a-stream-of-bytes"><a class="header" href="#a-stream-of-bytes">A stream of bytes</a></h1>
<p>Thinking of telemetry data as signals in a wire is difficult. If we want
to make sense of it, we need a better way to represent it. In this chapter,
you'll learn how to format data in binary and hexadecimal, how to represent
electrical signals as streams of bytes, and how to interpret individual
CAN frames.</p>
<p align="center">
    <img src="pipeline/step-1/../../images/candump.jpg" />
    <br/>
    <i>Traffic on a CAN bus</i>
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="representing-data"><a class="header" href="#representing-data">Representing data</a></h1>
<h2 id="binary"><a class="header" href="#binary">Binary</a></h2>
<p>You may be familiar with the notion that computers internally handle data as
sequences of zeros and ones. Indeed, a &quot;binary&quot; representation of numbers
(and more generally, any kind of data) turns out to be a natural choice for
computers and electrical circuitry. So how does it work?</p>
<p>Consider the number 2023. When you read this number, you implicitly understand
it using the base-10 representation we all learned in grade school. 2023 is made
up of 2 thousands, 0 hundreds, 2 tens, and 3 ones. Or:</p>
<blockquote>
<p>2023 = <strong>2</strong> × 10<sup>3</sup> + <strong>0</strong> × 10<sup>2</sup> + <strong>2</strong> × 10<sup>1</sup> + <strong>3</strong> × 10<sup>0</sup>.</p>
</blockquote>
<p>This common base-10 (or &quot;decimal&quot;) representation of numbers likely developed because of
the 10 fingers on human hands, but there is really nothing special about 10. For example,
it is also true that:<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<blockquote>
<p>2023 = <strong>1</strong> × 2<sup>10</sup> + <strong>1</strong> × 2<sup>9</sup> + <strong>1</strong> × 2<sup>8</sup> + <strong>1</strong> × 2<sup>7</sup> + <strong>1</strong> × 2<sup>6</sup> + <strong>1</strong> × 2<sup>5</sup> + <strong>0</strong> × 2<sup>4</sup> + <strong>0</strong> × 2<sup>3</sup> + <strong>1</strong> × 2<sup>2</sup> + <strong>1</strong> × 2<sup>1</sup> + <strong>1</strong> × 2<sup>0</sup>.</p>
</blockquote>
<p>Working in a base-2 (or &quot;binary&quot;) representation, where every digit must be
either 0 or 1, we can see that 2023 can be written as 11111100111. To avoid
confusion between bases, we typically prepend the prefix &quot;0b&quot; to numbers written
in binary. And so, 2023 = 0b11111100111.</p>
<p>Binary gives us a way to &quot;encode&quot; signals sent on wires into something more
familiar—numbers. A signal with a voltage profile of high-high-high-low, for
example,  maps to 0b1110 in binary, or 14 in decimal. Nevertheless, binary is
difficult for humans to work with directly. We need a better representation for
raw data<sup class="footnote-reference"><a href="#2">2</a></sup>.</p>
<blockquote>
<h3 id="terminology"><a class="header" href="#terminology">Terminology</a></h3>
<p>Just as we refer to each character in a decimal number as a digit, we also define the
term <em>bit</em> to mean &quot;<b>b</b>inary dig<b>it</b>&quot;. The number 0b10101011 has 8 bits.</p>
<p>Binary numbers can grow quite long, and so <em>bytes</em> (where 1 byte = 8 bits) are more
commonly used as a unit when speaking of binary data.</p>
</blockquote>
<h2 id="hexadecimal"><a class="header" href="#hexadecimal">Hexadecimal</a></h2>
<p>Hexadecimal is a base-16 numbering system. Like binary, it is more useful for representing
raw data than decimal. But unlike binary, hexadecimal tends to be much easier to read at
a glance. Continuing the previous example, we may write:</p>
<blockquote>
<p>2023 = <strong>7</strong> × 16<sup>2</sup> + <strong>14</strong> × 16<sup>1</sup> + <strong>7</strong> × 16<sup>0</sup></p>
</blockquote>
<p>Here we run into trouble with the numerals we have at our disposal. The above coefficients
would suggest that the base-16 representation of 2023 is something like 7|14|7. Since there
are no natural single-character glyphs for numbers above 9, the common practice is to continue
with the alphabet (10 → A, 11 → B, 12 → C, etc.). Therefore, the hexadecimal representation of
2023 becomes 0x7E7 (where the prefix &quot;0x&quot; denotes hexadecimal).</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">decimal</th><th style="text-align: center">binary</th><th style="text-align: center">hexadecimal</th></tr></thead><tbody>
<tr><td style="text-align: center">00</td><td style="text-align: center">0b0000</td><td style="text-align: center">0x0</td></tr>
<tr><td style="text-align: center">01</td><td style="text-align: center">0b0001</td><td style="text-align: center">0x1</td></tr>
<tr><td style="text-align: center">02</td><td style="text-align: center">0b0010</td><td style="text-align: center">0x2</td></tr>
<tr><td style="text-align: center">03</td><td style="text-align: center">0b0011</td><td style="text-align: center">0x3</td></tr>
<tr><td style="text-align: center">04</td><td style="text-align: center">0b0100</td><td style="text-align: center">0x4</td></tr>
<tr><td style="text-align: center">05</td><td style="text-align: center">0b0101</td><td style="text-align: center">0x5</td></tr>
<tr><td style="text-align: center">06</td><td style="text-align: center">0b0110</td><td style="text-align: center">0x6</td></tr>
<tr><td style="text-align: center">07</td><td style="text-align: center">0b0111</td><td style="text-align: center">0x7</td></tr>
<tr><td style="text-align: center">08</td><td style="text-align: center">0b1000</td><td style="text-align: center">0x8</td></tr>
<tr><td style="text-align: center">09</td><td style="text-align: center">0b1001</td><td style="text-align: center">0x9</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">0b1010</td><td style="text-align: center">0xA</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">0b1011</td><td style="text-align: center">0xB</td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">0b1100</td><td style="text-align: center">0xC</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center">0b1101</td><td style="text-align: center">0xD</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center">0b1110</td><td style="text-align: center">0xE</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center">0b1111</td><td style="text-align: center">0xF</td></tr>
</tbody></table>
</div><div style="text-align: center"><i>The first 16 natural numbers in decimal, binary, and hexadecimal</i></div>
<p>As you'll see in the next chapter, both binary and hexadecimal are useful ways of interpreting
messages sent on the CAN bus.</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Don't worry about how to come up with this expression for now. It's not terribly difficult,
but for this training you will only need to be familiar with the concept and the appropriate
Python functions to call.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>&quot;Raw data&quot; generally refers to any information that is not meant to be read or written
by humans. CAN frames, as we will see later, are one such example. It is also worth noting
that raw data is often referred to as <em>binary</em> data to emphasize that it is best thought of
as bytes and not as text. You may also hear executable files called <em>binaries</em> for a
similar reason.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="can-frames"><a class="header" href="#can-frames">CAN frames</a></h1>
<p>As mentioned in <a href="pipeline/step-1/../step-0">Chapter 2</a>, the CAN bus is the network on which all
the solar car's components communicate with one another. Messages sent on this
network are called CAN frames.</p>
<p><img src="pipeline/step-1/../../images/CAN-frame-electrical.png" alt="An electrical view of a CAN bus frame" /></p>
<div style="text-align: center"><i>The electrical view of a CAN bus frame</i></div>
<br>
<img src="pipeline/step-1/../../images/CAN-frame.svg" style="background-color: #FFFFFF"/>
<br/> <br/>
<div style="text-align: center"><i>A simplified view of a CAN bus frame</i></div>
<p>As shown above, many of this bits in a frame are responsible for ensuring reliable
and orderly transmission on the line (e.g. the 16 bits for the cyclic redundancy check).
These details are largely unimportant for Software. For our purposes, a CAN frame is
composed of two parts: the frame ID and the data.</p>
<ul>
<li><strong>Frame ID</strong>: The frame ID (also called the arbitration ID, message ID, standard identifier,
or simply ID) contains 11 bits and is responsible for identifying the sender of
the CAN frame and the type of values contained within. For example, on a given CAN network,
a frame ID of 0x403 might correspond to velocity measurement message from one motor
controller, an ID of 0x413 might correspond to the same message from another motor
controller, and an ID of 0x602 might indicate a temperature measurement message from an
MPPT.</li>
<li><strong>Data</strong>: Up to 64 bits of a CAN frame contain the actual values of some signal. This
is the core of the message.</li>
</ul>
<p>In the next section you'll learn more about CAN frames as you try your hand at decoding
them yourself.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise---thinking-like-a-computer"><a class="header" href="#exercise---thinking-like-a-computer">Exercise - Thinking like a computer</a></h1>
<p>It's time to put your newfound CAN bus knowledge to use. In this exercise, you'll
manually decode a few CAN frames in preparation for later automating this first stage of
the telemetry processing pipeline with Python.</p>
<p>For this exercise, assume we are working on a CAN bus containing the following four
devices:</p>
<ol>
<li>An Elmar Solar MPPT with base address 0x600.</li>
<li>An Elmar Solar MPPT with base address 0x610.</li>
<li>An Elmar Solar MPPT with base address 0x620.</li>
<li>A Tritium WaveSculptor 22 Motor Controller with base address 0x400.</li>
</ol>
<p>To decode the following CAN frames observed on this network, you will need to
refer to the relevant datasheets for each device, which can be found in the
corresponding sections of the Hardware Reference in this handbook (see the
sidebar on the left).</p>
<blockquote>
<h3 id="a-note-on-types"><a class="header" href="#a-note-on-types">A note on types</a></h3>
<p>In the CAN frame specifications for each device, you will find information
about the &quot;type&quot; of a variable inside a message. For example, the
&quot;Identification Information&quot; frame for a motor controller is specified as
containing two variables of type <code>Uint32</code>. Similarly, you will also
find references to <code>Uint8</code>, <code>Uint16</code>, etc. These types signify that the
bit pattern in the data field should be parsed as an unsigned (i.e. nonnegative)
integer, with bit-widths of 32, 8, 16, etc. Unsigned integers are not too hard
to parse by hand; it's analogous to the discussion in
<a href="pipeline/step-1/../step-1/representing-data.html">Section 3.1</a>.</p>
<p>You will also see messages where variables are given the type <code>float</code> (explicitly in
the MPPT datasheet; implicitly in the motor controller specs). A <code>float</code> is a
representation of fractional numbers, following the
<a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754 Standard</a>. 1.5, -2.0, 10000000.0, and
0.30000000000000004 can all be represented with floating point numbers. Although most
signals are naturally of type <code>float</code> (temperature, velocity, voltage, etc. are not
going to be integers), parsing <code>float</code>s by hand is entirely different than for integers
and is very tedious. You can use an online converter like
<a href="https://www.scadacore.com/tools/programming-calculators/online-hex-converter/">this one</a>
to decode <code>float</code>s from their hex representation (you can omit the &quot;0x&quot; in the converter).
The result will be in the &quot;little-endian&quot; cell.</p>
</blockquote>
<h2 id="frames-to-decode"><a class="header" href="#frames-to-decode">Frames to decode</a></h2>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Frame ID</th><th style="text-align: center">Data</th></tr></thead><tbody>
<tr><td style="text-align: center">0x625</td><td style="text-align: center">0x0000000500018028</td></tr>
</tbody></table>
</div></div>
<br/>
<details>
<summary>Solution</summary>
<p>This is a &quot;Status&quot; message sent by the MPPT at base address 0x620.
The signal values are:</p>
<pre><code class="language-python">{
    &quot;CAN_RX_error_counter&quot;: 0,
    &quot;CAN_TX_error_counter&quot;: 0,
    &quot;CAN_TX_overflow_counter&quot;: 0,
    &quot;HW_overvoltage&quot;: 1,
    &quot;HW_overcurrent&quot;: 0,
    &quot;Twelve_V_undervoltage&quot;: 0,
    &quot;Batter_full&quot;: 0,
    &quot;Battery_low&quot;: 0,
    &quot;Mosfet_overheat&quot;: 0,
    &quot;Low_array_power&quot;: 0,
    &quot;Global_MPPT&quot;: 0,
    &quot;Local_MPPT&quot;: 0,
    &quot;Duty_cycle_max&quot;: 0,
    &quot;Duty_cycle_min&quot;: 0,
    &quot;Mosfet_temperature_error&quot;: 0,
    &quot;Output_voltage_max&quot;: 0,
    &quot;Input_current_max&quot;: 0,
    &quot;Input_current_min&quot;: 0,
    &quot;Mode&quot;: 1,
    &quot;Test_counter&quot;: 40
}
</code></pre>
</details>
<hr />
<br/>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Frame ID</th><th style="text-align: center">Data</th></tr></thead><tbody>
<tr><td style="text-align: center">0x409</td><td style="text-align: center">0xDA35EF3F68E75440</td></tr>
</tbody></table>
</div></div>
<br/>
<details>
<summary>Solution</summary>
<p>This is a &quot;3.3V &amp; 1.9V Voltage Rail Measurement&quot; message sent by the motor
controller at base address 0x400. The signal values are:</p>
<pre><code class="language-python">{
    &quot;Supply1V9&quot;: 1.868830919265747,
    &quot;Supply3V3&quot;: 3.3266239166259766
}
</code></pre>
</details>
<hr />
<br/>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Frame ID</th><th style="text-align: center">Data</th></tr></thead><tbody>
<tr><td style="text-align: center">0x612</td><td style="text-align: center">0x506B76410276B141</td></tr>
</tbody></table>
</div></div>
<br/>
<details>
<summary>Solution</summary>
This is a "Temperature" message sent by the MPPT at base address 0x610.
The signal values are:
<pre><code class="language-python">{
    &quot;Controller_temperature&quot;: 22.182621002197266,
    &quot;Mosfet_temperature&quot;: 15.401199340820312
}
</code></pre>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="an-object-in-memory"><a class="header" href="#an-object-in-memory">An object in memory</a></h1>
<p>Now that you've had a chance to decode a couple CAN frames by hand, you can probably
agree that manually fiddling with bits and bytes is a slow and tedious process.
Considering that dozens of frames will be sent on the car's CAN bus every second,
we're going to need a way to automate the decoding.</p>
<p>In this chapter, you will build the foundation of a telemetry processing pipeline
with Python. Raising the level of abstraction from bytes to Python objects, you
will be able to process hundreds of CAN messages in the blink of an eye. At the end
of the chapter, you will use your new program to pinpoint the cause of an electrical
failure in a fictional post-mortem on the car.</p>
<p align="center">
    <img src="pipeline/step-2/../../images/python_memory.png" />
    <br/>
    <i>Python memory</i>
</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-python-programming-language"><a class="header" href="#the-python-programming-language">The Python programming language</a></h1>
<p>Python is a simple, flexible, and general-purpose programming language.
Due to the high-level abstractions it provides, it is commonly used in
a wide array of domains and boasts a rich and growing ecosystem.</p>
<p align="center">
    <img src="pipeline/step-2/python/../../../images/python-logo.png" width="150px"/>
    <br/>
    <i>Python logo</i>
</p>
<p>Python is the primary programming language used in the Software team,
both due to its approachability for beginners and the availability of
specific libraries we leverage in our system. In this section, you will
setup a development environment for Python and learn the basics of the
language.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up"><a class="header" href="#setting-up">Setting up</a></h1>
<p>In this section, you'll be guided through a Python installation and
development setup.</p>
<blockquote>
<p>The instructions in the section are opinionated. That is, there are
alternative ways to orchestrate a Python development environment,
but the author of this handbook recommends the ways listed here.
If you are familiar with and prefer an alternative method (e.g.
anaconda), feel free to diverge from these instructions, but it
may become harder to debug your specific setup if the need arises.</p>
</blockquote>
<h2 id="macos"><a class="header" href="#macos">macOS</a></h2>
<p>If macOS is your operating system of choice, you likely already have
Python installed, but the specific version is probably old and best left
alone. To get started, open the terminal (Terminal.app in Applications).
The terminal is an environment where you can control your computer with
textual commands instead of a GUI. You will use the terminal a lot in
your software career.</p>
<blockquote>
<p>In the terminal, commands are issued following the prompt (typically a
<code>$</code> or <code>&gt;</code>). Commands listed here follow the format <code>$ [command]</code>, to
indicate the <code>[command]</code> is to be run in the terminal. When copying
these commands, do not copy the leading <code>$</code>.</p>
</blockquote>
<h3 id="install-xcode-command-line-tools"><a class="header" href="#install-xcode-command-line-tools">Install XCode command line tools</a></h3>
<p>First, you should install a suite of command line tools Apple bundles
for developers, if you have not already. To do this, run:</p>
<pre><code class="language-bash">$ xcode-select --install
</code></pre>
<h3 id="install-homebrew"><a class="header" href="#install-homebrew">Install Homebrew</a></h3>
<p><a href="https://brew.sh/">Homebrew</a> is a package manager for macOS. Package
managers allow you to easily install and organize software packages. We'll
need Homebrew to install some packages later. If you don't already have
Homebrew, you can install it with:</p>
<pre><code class="language-bash">$ /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;
</code></pre>
<p>With that done, run:</p>
<pre><code class="language-bash">$ brew doctor
</code></pre>
<p>to ensure the everything is installed correctly, and then run:</p>
<pre><code class="language-bash">$ brew update
</code></pre>
<p>to ensure things are up-to-date.</p>
<h3 id="install-pyenv"><a class="header" href="#install-pyenv">Install pyenv</a></h3>
<p>We're going to use <a href="https://github.com/pyenv/pyenv">pyenv</a> to manage our Python
installation. While you can install Python directly through Homebrew, the version
may be a couple months out of date. Pyenv allows you to manage multiple Python
versions easily, and you will never have to wait for Homebrew if you need to update
to the latest version.</p>
<pre><code class="language-bash">$ brew install pyenv
</code></pre>
<p>Next you will need to follow the
<a href="https://github.com/pyenv/pyenv#set-up-your-shell-environment-for-pyenv">shell setup for pyenv</a>
to properly integrate pyenv into the command line. To check which shell you are using (likely
zsh, but possibly bash), run:</p>
<pre><code class="language-bash">$ echo $SHELL
</code></pre>
<p>Once you have followed the shell setup instructions, restart your shell:</p>
<pre><code class="language-bash">$ exec &quot;$SHELL&quot;
</code></pre>
<p>Now you should be able to use pyenv to manage Python versions. To start, run:</p>
<pre><code class="language-bash">$ pyenv versions
</code></pre>
<p>You should see that only the system python is installed. To install the latest version
of Python (3.12.0 currently), run:</p>
<pre><code class="language-bash">$ pyenv install 3.12.0
</code></pre>
<p>Then, you may want to set this version to be the global default:</p>
<pre><code class="language-bash">$ pyenv global 3.12.0
</code></pre>
<h3 id="install-direnv"><a class="header" href="#install-direnv">Install direnv</a></h3>
<p>You should now have a new global installation of Python. At this point, you could
begin writing Python scripts and installing Python packages. For various reasons,
however, it is not advisable to install packages in your global Python environment.
Instead, best practices advise creating per-project environments so as to avoid
any cross-project conflicts. There are <em>many</em> ways to create and manage so-called
virtual environments (virtualenv, venv, pipenv, anaconda, poetry, direnv, pyenv-virtualenv,
etc.), but the author recommends <a href="https://direnv.net/">direnv</a>.</p>
<p>Direnv allows you to create project environments that automatically load/unload
when you enter/exit the project folder. Install it with Homebrew:</p>
<pre><code class="language-bash">$ brew install direnv
</code></pre>
<p>To work properly, direnv needs to be able to hook into the shell. Follow the
<a href="https://direnv.net/docs/hook.html">setup instructions</a> to finish the installation.
For example, if you are using zsh, you would run:</p>
<pre><code class="language-bash">$ echo 'eval &quot;$(direnv hook zsh)&quot;' &gt;&gt; ~/.zshrc
</code></pre>
<blockquote>
<p>If you use <a href="https://github.com/tmux/tmux/wiki">tmux</a> as a terminal multiplexer,
you may need to make some adjustments to your shell config file to ensure everything
works. For example, the author of this handbook had to add the following lines to
his <code>.zshrc</code>:</p>
<pre><code class="language-bash"># Make tmux play nicely with direnv
alias tmux='direnv exec / tmux'

# Need to reload direnv in tmux for some reason to ensure
# correct environment variables. Particularly for pyenv.
if [ -n &quot;$TMUX&quot; ] &amp;&amp; [ -n &quot;$DIRENV_DIR&quot; ]; then
    export DIRENV_LOG_FORMAT= # Don't print this reload or the Powerlevel10k prompt will freak out.
    direnv reload
fi
</code></pre>
</blockquote>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>Windows is a trickier platform for Python development. Because many packages are
only available on Unix-like platforms (macOS or Linux), and because the Raspberry
Pi runs Linux anyway, it's best for consistency to install the Windows Subsystem
for Linux (WSL). To install WSL, follow <a href="https://learn.microsoft.com/en-us/windows/wsl/setup/environment">Microsoft's instructions for setting up
a development environment</a>
(follow up through the &quot;Update and upgrade packages&quot; section; the following sections
are worth reading but not necessary right now).</p>
<p>Once you have setup WSL and are in a Linux command line, follow the previous instructions
for installing pyenv and direnv, but use your system package manager (<code>apt</code> if on Ubuntu)
instead of Homebrew.</p>
<h2 id="text-editor"><a class="header" href="#text-editor">Text Editor</a></h2>
<p>To actually write code, you will need a text editor or an IDE. This is the subject of a
long-running programming flame war, but <a href="https://code.visualstudio.com/">VS Code</a> and
<a href="https://www.jetbrains.com/pycharm/">PyCharm</a> are good choices.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basics"><a class="header" href="#basics">Basics</a></h1>
<blockquote>
<p>This page will be updated as we get a better grasp of incoming members'
Python background. For Python beginners,
<a href="https://docs.python.org/3/tutorial/">the official Python tutorial</a> is
a very good resource to pick up the language as you work through the
exercise in the following section.</p>
</blockquote>
<h2 id="running-python-code"><a class="header" href="#running-python-code">Running Python code</a></h2>
<p>The Python interpreter can be accessed interactively in the terminal:</p>
<pre><code class="language-bash">$ python
Python 3.12.0 (main, Oct  2 2023, 17:01:41) [Clang 14.0.0 (clang-1400.0.29.202)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; print(&quot;Hello, world!&quot;)
Hello, world!
&gt;&gt;&gt; 1 + 2
3
&gt;&gt;&gt;
</code></pre>
<blockquote>
<p>Depending on your Python installation, you may need to use <code>python3</code> or <code>py</code> instead
of the <code>python</code> command.</p>
</blockquote>
<p>But, for larger scripts, it's better to write Python code into a file, which can be run
later. For example, try creating a file called <code>hello_world.py</code> with the contents:</p>
<pre><code class="language-python">print(&quot;Hello, world!&quot;)
</code></pre>
<p>We can then run this file in the terminal:</p>
<pre><code class="language-bash">$ python hello_world.py
Hello, world!
</code></pre>
<p>It should also possible to run the file using the &quot;Run&quot; button in your editor of choice.</p>
<h2 id="simple-examples"><a class="header" href="#simple-examples">Simple examples</a></h2>
<p>Many of the following code snippets have been taken from
<a href="https://docs.python.org/3/tutorial/">the official Python tutorial</a>. The purpose of this
section is to give a <em>very</em> broad overview of what Python looks like. The hope is that you
will learn the relevant parts of Python as you need them, while you work on the telemetry
pipeline as part of this training. To learn the language more thoroughly, please refer
to that tutorial.</p>
<hr />
<p>Variables in Python are declared using the <code>[name] = [value]</code> syntax, and messages can
be output to the screen using the <code>print</code> function:</p>
<pre><code class="language-python">i = 256 * 256
print(&quot;The value of i is&quot;, i) # output: The value of i is 65536
</code></pre>
<hr />
<p>On any line, everything after a <code>#</code> is a comment. They do not affect to behavior of your code.</p>
<pre><code class="language-python"># This is a comment.
x = 1 # This is also a comment.
# x = 2
print(x) # output: 1
</code></pre>
<hr />
<p>Python defines a set of default types available to use in your code, including integers, floating
point (fractional) numbers, complex numbers, booleans (true/false), strings (text), lists, and much more.</p>
<pre><code class="language-python">an_integer = -10
a_float = 1.5
a_complex_number = 1 + 2j
a_boolean = True
a_string = &quot;This is a string!&quot;
a_list = [1, 2, 3, 4, 5]
</code></pre>
<hr />
<p>Python programmers can use the <code>if</code>, <code>elif</code>, and <code>else</code> keywords to cause different behavior depending
on given conditions.</p>
<pre><code class="language-python">x = 5
if x &lt; 0:
    x = 0
    print('Negative changed to zero')
elif x == 0:
    print('Zero')
elif x == 1:
    print('Single')
else:
    print('More') # output: More
</code></pre>
<hr />
<p><code>for</code> and <code>while</code> loops can be used to repeat certain behavior. Loops are commonly used
to iterate over collections, like lists. For example:</p>
<pre><code class="language-python">a = ['Mary', 'had', 'a', 'little', 'lamb']
for i in range(len(a)):
    print(i, a[i]) # output:
                   # 0 Mary
                   # 1 had
                   # 2 a
                   # 3 little
                   # 4 lamb
</code></pre>
<hr />
<p>Functions are blocks of code which can defined once and called many times later.
Functions are Python are defined using the <code>def</code> keyword:</p>
<pre><code class="language-python">def fib(n): # write Fibonacci series up to n
    a, b = 0, 1
    while a &lt; n:
        print(a, end=' ')
        a, b = b, a+b
    print()

# Now call the function we just defined:
fib(100) # output: 0 1 1 2 3 5 8 13 21 34 55 89
fib(2000) # output: 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597
</code></pre>
<hr />
<p>Sometimes you'll want to use code that someone else wrote or that lives in a different file
in your own project. You can do this with the <code>import</code> statement.</p>
<pre><code class="language-python">import math

print(math.sin(0.5)) # output: 0.479425538604203
</code></pre>
<p>Here, we imported the <code>math</code> module from Python's standard library to calculate
the sine of 0.5. The standard library is automatically available to your Python
program. Other packages must be installed before they can be used.</p>
<hr />
<p>These examples only scratch the surface of what there is to learn about Python. Again,
there are many good online resources that go into much more detail!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise---an-automated-autopsy"><a class="header" href="#exercise---an-automated-autopsy">Exercise - An automated autopsy</a></h1>
<p>This exercise is broken into two parts. In the first section, you will craft a
Python parser to interpret real CAN frames sent by an isolated MPPT under
idle operation. Values sent by this MPPT will be boring and predictable. In part
two, you'll adapt your parser to handle CAN data from multiple connected devices.
The data in part two will be generated to contain a mystery—at some point in this
fabricated scenario, a failure will occur in the car. Your job is to analyze the
CAN traffic to determine when and where the failure first appeared, and what might
have caused it.</p>
<h2 id="part-1---isolated-mppt"><a class="header" href="#part-1---isolated-mppt">Part 1 - Isolated MPPT</a></h2>
<p><a href="pipeline/step-2/../../misc/mppt_data.txt">This data file</a> contains CAN frames sent by an MPPT
(base address 0x600) on it's own CAN network. Frames in this file appear in a
<code>[Frame ID] [Data]</code> text format, separated by newlines. Frame IDs and data are
given in hex, although the leading &quot;0x&quot; is omitted.</p>
<p>Your job is to use the MPPT datasheet to construct a Python program that processes
this file into something human-readable.</p>
<p>Remember that variables in CAN frames are stored in little-endian byte-order.</p>
<hr />
<details>
<summary><b>Hint</b></summary>
<p>You may find the
<a href="https://docs.python.org/3/library/binascii.html#binascii.unhexlify">binascii.unhexlify</a>
and <a href="https://docs.python.org/3/library/struct.html#struct.unpack">struct.unpack</a>
functions helpful in converting from a hex string to an integer or float.</p>
<p>You can also use <code>int(some_hex_string, 16)</code> to parse a hex string to an integer. This
can also be done with <code>unpack</code> and <code>unhexlify</code>, but <code>unhexlify</code> requires an even number
of hex digits, so it can be a bit nicer to just use <code>int</code> directly for, say, the frame
id, which is 3 hex digits.</p>
</details>
<hr />
<details>
<summary><b>Example</b></summary>
<p>The first line in the data file is <code>604 6666DA420000E040</code>. We can recognize this as a
frame sent by the MPPT at base address 0x600 with an id offset of 0x4.</p>
<p>The relevant section of the MPPT datasheet tells us that this is the &quot;Limits&quot; message,
which contains the following variables.</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Byte</th><th>Type</th><th>Unit</th></tr></thead><tbody>
<tr><td>Max. Output Voltage</td><td>0-3</td><td>FLOAT</td><td>Volt</td></tr>
<tr><td>Max. Input Current</td><td>4-7</td><td>FLOAT</td><td>Ampere</td></tr>
</tbody></table>
</div>
<p>Here's how we can parse this frame in Python.</p>
<p>Let's start by storing the first frame in a variable and then splitting it
into the frame id and the data:</p>
<pre><code class="language-python">raw_frame = &quot;604 6666DA420000E040&quot;
frame_id, data = raw_frame.split(&quot; &quot;)
</code></pre>
<p>The <code>frame_id, data = ...</code> syntax we used above is called &quot;unpacking&quot; or
&quot;destructuring&quot;, and it is a clean way of breaking down a list (or any iterable)
into multiple variables. In this case, <code>raw_frame.split(&quot; &quot;)</code> returned a list
of 2 strings, the first of which we assigned to <code>frame_id</code>, and the second to
<code>data</code>. It would have been equivalent to write:</p>
<pre><code class="language-python">split = raw_frame.split(&quot; &quot;)
frame_id = split[0]
data = split[1]
</code></pre>
<p>At this point, both the <code>frame_id</code> and <code>data</code> variable are strings (text).
Because in general we need to examine the offset of the frame id from the
base address to determine the message type, we will need to convert <code>frame_id</code>
to an integer. Similarly, we will need to end up converting portions of
data into the types specified by the MPPT datasheet.</p>
<p>To convert <code>frame_id</code> into an integer, we can use
<a href="https://docs.python.org/3/library/functions.html#int">Python's builtin <code>int</code></a>
function with two arguments to parse a string into an integer.</p>
<pre><code class="language-python">frame_id = int(frame_id, 16)
</code></pre>
<p>We can then determine the offset from the base address programmatically:</p>
<pre><code class="language-python">offset = frame_id - 0x600
</code></pre>
<p>Notice that Python allows you to write integers directly in hex using the <code>0x</code> prefix.</p>
<p>Of course, in this case we already know that the offset is 4. But, in general, you'll
need to determine the offset and then examine the data accordingly. Let's say we're
choosing to do this in one big <code>if ... elif ... elif ... else</code> block.</p>
<pre><code class="language-python">if offset == 0:
    ... # handle offset 0
elif offset == 1
    ... # handle offset 1

... # handle more offsets

elif offset == 4
    ... # handle offset 4

... # handle more offsets
</code></pre>
<p>For the frame we're examining in this example, we know that we're going to end up inside
the branch for <code>offset == 4</code>. The MPPT specs tell us that a broadcast message with offset
4 contains two 32-bit floats in the data field. We can break the data into halves using
Python's slicing syntax:</p>
<pre><code class="language-python">first_half = data[:8]
second_half = data[8:]
</code></pre>
<p>And then we can use <code>unhexlify</code> to convert each half from a string to the represented bytes:</p>
<pre><code class="language-python">from binascii import unhexlify

first_half = unhexlify(first_half)
second_half = unhexlify(second_half)
</code></pre>
<p>Note that we could equivalently have chosen to <code>unhexlify</code> the whole message first, and then
slice it into halves.</p>
<p>Finally, we can use <code>unpack</code> to decode the bytes into little-endian floats (the <code>&quot;&lt;f&quot;</code>
given to <code>unpack</code> is a format specifier meaning little-endian 32-bit float; you can find
more info in the docs for <code>unpack</code>).</p>
<pre><code class="language-python">from struct import unpack

max_output_voltage = unpack(&quot;&lt;f&quot;, first_half)[0]
max_input_current = unpack(&quot;&lt;f&quot;, second_half)[0]
</code></pre>
<p>At this point, we've decoded the CAN frame! You can now print the decoded information to
the screen, append it to a list, store it in a dictionary, or use whatever format you
think works best.</p>
</details>
<hr />
<details>
<summary><b>Solution</b></summary>
<p>There are many possible ways to write the code to solve this exercise, so
you're not expected to have written code that looks the same as this.
This is only one of the possible solutions and is here as a reference.</p>
<pre><code class="language-python"># We're going to use the `unhexlify` function to convert hex strings into the
# actual bytes they represent.
from binascii import unhexlify

# We'll also use the `unpack` function to decode `float`s and `int`s from
# raw bytes.
from struct import unpack

def decode_mppt_data(offset, data):
    if offset == 0:
        # Input measurements
        return {
            &quot;Input Voltage (V)&quot;: unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;Input Current (A)&quot;: unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    elif offset == 1:
        # Output measurements
        return {
            &quot;Output Voltage (V)&quot;: unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;Output Current (A)&quot;: unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    elif offset == 2:
        # Temperature
        return {
            &quot;Mosfet Temperature (deg. Celsius)&quot;    : unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;Controller Temperature (deg. Celsius)&quot;: unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    elif offset == 3:
        # Auxiliary power supply
        return {
            &quot;12V (V)&quot;: unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;3V (V)&quot; : unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    elif offset == 4:
        # Limits
        return {
            &quot;Max. Output Voltage (V)&quot;: unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;Max. Input Current (C)&quot; : unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    elif offset == 5:
        # Status
        return {
            &quot;CAN RX error counter&quot;   : unpack(&quot;&lt;B&quot;, data[:1])[0],
            &quot;CAN TX error counter&quot;   : unpack(&quot;&lt;B&quot;, data[1:2])[0],
            &quot;CAN TX overflow counter&quot;: unpack(&quot;&lt;B&quot;, data[2:3])[0],
            &quot;Error flags&quot;            : unpack(&quot;&lt;B&quot;, data[3:4])[0],
            &quot;Limit flags&quot;            : unpack(&quot;&lt;B&quot;, data[4:5])[0],
            &quot;Mode&quot;                   : unpack(&quot;&lt;B&quot;, data[5:6])[0],
            &quot;Test counter&quot;           : unpack(&quot;&lt;B&quot;, data[7:])[0],
        }
    elif offset == 6:
        # Power connector
        return {
            &quot;Output Voltage (Battery side of fuse) (V)&quot;: unpack(&quot;&lt;f&quot;, data[:4])[0],
            &quot;Power connector Temperature (deg. Celsius)&quot; : unpack(&quot;&lt;f&quot;, data[4:])[0],
        }
    else:
        # Unknown message, throw an error to the caller.
        raise Exception(f&quot;No message matches offset 0x{offset:x}&quot;)

def decode_data(base_address, offset, data):
    if base_address == 0x600:
        # If the base address belongs to a known MPPT, decode the data using
        # a MPPT-specific helper function, and return the decoded message.
        return { &quot;sender&quot;: base_address, &quot;message&quot;: decode_mppt_data(offset, data) } 
    else:
        # Otherwise, the message doesn't match any known device. Throw an error
        # to the caller.
        raise Exception(f&quot;No device matches base address 0x{base_address:x}&quot;)

with open(&quot;mppt_data.txt&quot;, &quot;r&quot;) as f:
    for line in f:
        # Take the line, remove any leading/trailing whitespace,
        # and then split across the space dividing the frame id from the data.
        left, right = line.strip().split(&quot; &quot;)

        # Convert the frame id hex string into an actual number.
        frame_id = int(left, 16)

        # Convert the data hex string into bytes.
        data = unhexlify(right)

        # Decompose the frame id into a base address and offset.
        base_address, offset = divmod(frame_id, 16)
        base_address *= 16

        # Decode the message and print it.
        print(decode_data(base_address, offset, data))
</code></pre>
<p>The result of running this program on the MPPT data provided above can
be found in <a href="pipeline/step-2/../../misc/mppt_data_decoded.txt">this output file</a>.</p>
</details>
<hr />
<h2 id="part-2---chaos-on-the-can-network"><a class="header" href="#part-2---chaos-on-the-can-network">Part 2 - Chaos on the CAN network</a></h2>
<p>In this exercise, you'll will be given a dump of CAN traffic from the following
made-up scenario.</p>
<blockquote>
<p>Because the CAN data for this scenario has been fabricated, you shouldn't expect
to see super-realistic and -consistent data reported across all the devices on
the network. Rather, the tampered data has been made in a way to (hopefully) make
localizing a fault easier.</p>
</blockquote>
<p>While working on an electrical line in SC7s, members of the Electrical team heard a pop
from within the car. A few seconds later, the top-shell was lifted, and one of the devices
attached to the CAN line was found damaged and unresponsive. The car was then immediately
powered off.</p>
<p>This incident occurred during winter, while the car was idle (not driving) and being worked-on
in North Garage. The Electrical team reported the following CAN network configuration:</p>
<ul>
<li>MPPT at base address 0x600</li>
<li>MPPT at base address 0x610</li>
<li>MPPT at base address 0x620</li>
<li>Motor controller at base address 0x400</li>
<li>Driver controls at base address 0x500</li>
<li>Battery management system</li>
</ul>
<p>They were also able to provide
<a href="pipeline/step-2/../../misc/can_traffic.txt">this log of CAN traffic in the minutes leading up to the incident</a>.</p>
<p><strong>By analyzing this CAN traffic, can you figure out which device was damaged, what type of damage
was sustained, and what may have caused the failure?</strong></p>
<h2 id="advice"><a class="header" href="#advice">Advice</a></h2>
<p>Many of the messages in the given data file come from the battery management system (BMS), which
works a little differently than the other devices you are familiar with. CAN frames broadcast
from the BMS are programmable and do not necessarily follow the base address + offset pattern
used by the other devices. For this exercise, <strong>the BMS is not relevant to electrical failure</strong>,
which means you should ignore any messages from the BMS (i.e. the ones that are not from
the MPPTs, motor controller, or driver controls).</p>
<p>You may also not need to decode every frame from the other devices. It's possible to complete
this exercise by identifying oddities in the raw frames, and limiting your focus only to those
oddities.</p>
<hr />
<details>
<summary><b>Hint #1</b></summary>
<p>We know that the &quot;pop&quot; was heard just a few seconds before the car was powered off (at which point
the CAN traffic ends). So it's reasonable to expect the failure to appear very near to the end
of the traffic log file.</p>
<p>You also should try looking for CAN messages that stop being sent <em>before</em> the rest of the traffic
ends, the idea being to identify the damaged device by seeing if it goes silent.</p>
<p>You might also try looking for messages that only start appearing near the end of the log file.
You may observe a &quot;reset&quot; message that one device sends when another stops responding.</p>
<p>Note that you can make these observations by only looking at the frame IDs and not actually
decoding any data. So this might be a good starting point.</p>
</details>
<hr />
<details>
<summary><b>Hint #2</b></summary>
<p>The previous hint should let you identify which device has failed: it's the motor controller
at base address 0x400. The last message sent by the motor controller occurs at line 42776,
over 300 lines before the file. For comparison, all the other devices on the network have
messages appearing at most 35 lines from the end of the file. You could also have identified
the issue with the motor controller by observing the first appearance of the message with
ID 0x503 at line 42888. This message is a &quot;reset&quot; message sent from the driver controls to
the motor controller, indicating a problem with the motor controller.</p>
<p>Now that you know which device has been damaged, it's time to figure out what happened.
To do this, you need to decode some messages from the motor controller. Many of the messages
have all zeros in their data—those probably aren't worth decoding. Also, remember that the
car isn't driving in this scenario, so messages indicating motor and vehicle velocities likely
aren't relevant either. For the remaining messages, try decoding, say, the last 10 instances of
each. Are there any values that are changing rapidly?</p>
</details>
<hr />
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-command-line"><a class="header" href="#the-command-line">The command line</a></h1>
<blockquote>
<p>Commands given in this chapter follow the format <code>$ [command]</code> first
mentioned in the <a href="tools/../pipeline/step-2/python/setting-up.html">Python setup chapter</a>.
Remember that the <code>$</code> indicates that the <code>[command]</code> should be run in the
terminal and is not itself part of the command.</p>
<p>This chapter also assumes a Unix (i.e. macOS or Linux) command line.</p>
</blockquote>
<p>Computers are most often used through the graphical user interface (GUI) provided
by the operating system. GUIs make common activities like browsing the web, reading
a PDF, etc. easy for humans. Programs, however, often prefer to operate on text
accessed through &quot;the command line&quot;. The command line is a place where you use
a program through its command line interface (CLI) as opposed to a GUI. Familiarity
with the command line is very useful for a programmer, and while this chapter will
only touch briefly on the basics of the terminal, it will hopefully help you
understand the command line usage throughout this handbook.</p>
<h2 id="navigating-file-hierarchies"><a class="header" href="#navigating-file-hierarchies">Navigating file hierarchies</a></h2>
<p>You are probably already familiar with using your operating system's GUI for file
management (Finder on macOS, File Explorer on Windows) to create/modify/delete folders
(also called &quot;directories&quot;) and files. You can do the same from the command line.</p>
<p>To begin, open a terminal and run:</p>
<pre><code class="language-bash">$ pwd
</code></pre>
<p>The <code>pwd</code> command prints the current/working directory. The output you see may look
like <code>/Users/username</code>. This is a Unix file path. File paths are a way to identify
a file or directory by constructing a &quot;path&quot; to follow in order to reach it from the
universal top-most directory (called the &quot;root&quot; directory). For example, consider the
following path:</p>
<pre><code class="language-bash">/Users/admin/documents/report.pdf
</code></pre>
<p>This path says:</p>
<ul>
<li>Inside of the root (<code>/</code>) folder, there is a folder called <code>Users</code>.</li>
<li>Inside of the <code>Users</code> folder, there is a folder called <code>admin</code>.</li>
<li>Inside of the <code>admin</code> folder, there is a folder called <code>documents</code>.</li>
<li>Inside of the <code>documents</code> folder, there is a file called <code>report.pdf</code>.</li>
</ul>
<p>Notice that folders on Unix-like systems are separated by <code>/</code>. On Windows, the
path separator is <code>\\</code>. Also notice that files (typically) contain an extension
that hints at the file type. The file extension for <code>report.pdf</code> is <code>.pdf</code>, meaning
this file is like a PDF.</p>
<p>Now that you understand Unix paths, let's discuss how to list files and move between folders.
For the remainder of this section, we'll assume the following file hierarchy, although you
are encouraged to try listing files on your own computer:</p>
<pre><code>foo
├── bar
│   ├── images
│   │   ├── cat.png
│   │   └── dog.png
│   └── info.txt
└── baz
    └── hello.txt
</code></pre>
<p>Let's assume you are currently positioned in the <code>foo</code> folder. The <code>ls</code> command lists files
in the current directory:</p>
<pre><code class="language-bash">$ ls
bar baz
</code></pre>
<p>You can also give <code>ls</code> a path to a folder.</p>
<pre><code class="language-bash">$ ls ./bar/images
cat.png dog.png
</code></pre>
<p>Notice the use a relative path. Instead of specifying the absolute path starting at the root
(<code>/</code>), we gave a path relative to the current directory (<code>.</code>). On Unix-like systems, <code>.</code> means
current directory and <code>..</code> means parent directory.</p>
<p>We can change our current directory using <code>cd</code>:</p>
<pre><code class="language-bash">$ cd ./bar
$ ls
images info.txt
</code></pre>
<p>Now, we've set the current folder to <code>foo/bar</code>. If wanted to move into <code>foo/baz</code>, we can
move back into the parent directory and then into <code>baz</code>:</p>
<pre><code class="language-bash">$ cd ..
$ cd ./baz
</code></pre>
<p>Note that we could have equivalently used <code>cd</code> just once by writing <code>$ cd ../baz</code>.</p>
<p>We can use the <code>cat</code> command to print the contents of a file.</p>
<pre><code class="language-bash">$ cat hello.txt
Hello!
$ cat ../bar/info.txt
This is some important info.
</code></pre>
<p>Using <code>ls</code>, <code>cd</code>, and <code>cat</code> is the simplest way to navigate through a file system on the
command line. On their own, they aren't very powerful, but they will come in handy any
time you find yourself on the command line. There is, of course, so much more to learn
about the command line that we can't cover here. If you're interested, check out
<a href="http://www.ee.surrey.ac.uk/Teaching/Unix/">this tutorial</a>.</p>
<h2 id="remote-development"><a class="header" href="#remote-development">Remote development</a></h2>
<p>You will often end up reaching for the command line when developing on remote computers.
For example, our Raspberry Pi microprocessor does not come with a screen or a keyboard.
And although we have purchased ones, it's often easier to access the Pi through the terminal.</p>
<h3 id="ssh"><a class="header" href="#ssh">SSH</a></h3>
<p>The Secure Shell Protocol (SSH) is a way to access remote computers through a CLI. You
probably already have SSH installed (OpenSSH, specifically). If not, you can install it
through your package manager.</p>
<p>In this section, we'll log in to the Raspberry Pi over SSH. Because this involves sharing
the IP address and password of our Pi, we will cover this in person, instead of writing it
here.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="goals"><a class="header" href="#goals">Goals</a></h1>
<p>Congratulations on completing Fall training! Now that you are familiar
with our telemetry system, let's go over some goals for the upcoming year.</p>
<blockquote>
<h3 id="project-listing-format"><a class="header" href="#project-listing-format">Project listing format</a></h3>
<p>The projects on this page are listed in the following format:</p>
<p><strong><em>Project name</em> ([⚠️  | ⭐️ | 🌱], 👥 [SIZE], 📅 [DURATION])</strong></p>
<p>A project's level of importance is given by:</p>
<ul>
<li>⚠️  ⇒  Very important, should be prioritized.</li>
<li>⭐️ ⇒  Important, ought to  happen eventually.</li>
<li>🌱 ⇒  Less critical and more free form, will depend on time and member interest.</li>
</ul>
<p>A rough estimate of the number of people that a project will require is given
in the <strong>👥 [SIZE]</strong> field. Similarly, a (very) rough estimate of a project's
expected duration in given in the <strong>📅 [DURATION]</strong> field.</p>
<p>These estimates are <strong>very</strong> rough and <strong>not</strong> hard requirements. The true duration or
amount of people working on a project may end up differing drastically from what
is predicted here.</p>
</blockquote>
<h2 id="polishing-the-current-system"><a class="header" href="#polishing-the-current-system">Polishing the current system</a></h2>
<p>The current telemetry system last year was only partly ready during
FGSP 2023; issues with internet connectivity at the track prevented
us from pushing last minute fixes to the Raspberry Pi. The following
items address aspects of the current system that either need fixing,
testing, or just some polish.</p>
<h3 id="basic-testing-and-data-collection----4-12--3-4-weeks"><a class="header" href="#basic-testing-and-data-collection----4-12--3-4-weeks"><em>Basic testing and data collection</em> (⚠️ , 👥 4-12, 📅 3-4 weeks)</a></h3>
<p>We need to test all the components in the current telemetry system with the
car driving. There are likely to be bugs that need fixing or things not quite
working as expected, and we need to ensure everything is functional before
parts of SC7s are cannibalized for SC8. This also presents an opportunity
to collect real data traces from the car for other projects
(<a href="system/goals.html#data-mocking-and-can-traffic-replays----2-4--3-6-weeks">Data mocking and CAN traffic replays</a> and
<a href="system/goals.html#exploring-time-series-data-with-machine-learning---1-5--3-18-weeks">Exploring time series data with machine learning</a>,
for example).</p>
<p>This project will likely coincide with the later parts of training and involve
the whole Software team, as it's good hands-on experience.</p>
<h3 id="postgres-backend-for-base-station-database----1-3--2-weeks"><a class="header" href="#postgres-backend-for-base-station-database----1-3--2-weeks"><em>Postgres backend for base-station database</em> (⚠️ , 👥 1-3, 📅 2 weeks)</a></h3>
<p>We currently use SQLite as the database of choice for telemetry data on the base-station.
To make this work with Grafana (which does not support SQLite out of the box), we use
the <a href="https://grafana.com/grafana/plugins/frser-sqlite-datasource/">Grafana SQLite Datasource</a>
plugin. However, we've discovered that the plugin does not seem to support M2 Macs, and
so this project will require refactoring the relevant code to target Postgres
(or a similar supported SQL database).</p>
<h3 id="more-space-efficient-serialization-in-xbee-communication----1-3--2-4-weeks"><a class="header" href="#more-space-efficient-serialization-in-xbee-communication----1-3--2-4-weeks"><em>More space-efficient serialization in XBee communication</em> (⚠️ , 👥 1-3, 📅 2-4 weeks)</a></h3>
<p>The Xbee modems we use (see <a href="system/../hardware/xbee.html">Digi XBee® SX 1-Watt 900 MHz RF</a>) are
limited to sending a maximum of 256 bytes per packet. We are able to transfer larger
messages by splitting the message into chunks, but this introduces issues if chunks
are lost in transmission and is generally inefficient. The current serialization format
we use for XBee communication, JSON, is very inefficient for this purpose. This project
will explore alternative serialization formats, like
<a href="https://msgpack.org/index.html">MessagePack</a> or something custom-made, to reduce the number
of bytes sent over radio and eliminate the need for buffered communication.</p>
<h3 id="improved-grafana-dashboard----2-5--4-12-weeks"><a class="header" href="#improved-grafana-dashboard----2-5--4-12-weeks"><em>Improved Grafana dashboard</em> (⚠️ , 👥 2-5, 📅 4-12 weeks)</a></h3>
<p>Our current Grafana dashboard is incomplete. This project will require adding
more panels for relevant signals (which is fairly straightforward) and may
explore how best to represent error and limit flags, as well as how to leverage
Grafana's more advanced features to, for example, issue an alert if a temperature
reading exceeds a safe value.</p>
<h2 id="new-projects"><a class="header" href="#new-projects">New projects</a></h2>
<h3 id="data-mocking-and-can-traffic-replays----2-4--3-6-weeks"><a class="header" href="#data-mocking-and-can-traffic-replays----2-4--3-6-weeks"><em>Data mocking and CAN traffic replays</em> (⚠️ , 👥 2-4, 📅 3-6 weeks)</a></h3>
<p>We will not always have access to live CAN data from the solar car during our
meetings. Initial work was done last year to provide virtual CAN data generation,
loosely based on previous CAN traffic. This project will expand upon this work
to introduce data mocking based more accurately on observed signals.</p>
<p>It would also be nice to be able to save CAN traffic and replay it at a
later time. We have done this sporadically and in a limited capacity in the past,
essentially writing CAN traffic to text files. It would be much better to store
this data in a well-organized database (perhaps hosted in the cloud; see
<a href="system/goals.html#cloud-hosted-databases-and-dashboard---2-4--3-6-weeks">Cloud hosted databases and dashboard</a>),
with an easier way to save traces.</p>
<p>Having CAN data saved and readily accessible is a prerequisite for projects which
need to run tests on or analyze such data (like
<a href="system/goals.html#rigorous-end-to-end-testing---2-5--6-18-weeks">Rigorous, end-to-end testing</a>
and
<a href="system/goals.html#exploring-time-series-data-with-machine-learning---1-5--3-18-weeks">Exploring time series data with machine learning</a>).</p>
<h3 id="rigorous-end-to-end-testing---2-5--6-18-weeks"><a class="header" href="#rigorous-end-to-end-testing---2-5--6-18-weeks"><em>Rigorous, end-to-end testing</em> (⭐️, 👥 2-5, 📅 6-18 weeks)</a></h3>
<p>No matter how well thought out a complex piece of software is, it is ultimately likely
to have bugs or be error-prone if it isn't battle-tested. This is especially true for
our telemetry system, since automobiles are generally not friendly environments for
computers. At any point during operation, the CAN connection may be jostled loose,
an XBee might go out of range, the Raspberry Pi may momentarily lose power or be
completely fried by excessive current, etc.</p>
<p>In all these scenarios, we want predictable invariants to be upheld. For
example, if the Raspberry Pi loses power, the information on the onboard
database should contain all the traffic parsed before the power loss (within a
window of, say, a few seconds). Or, if the onboard XBee is jostled lose mid-transmission
and sends a corrupted packet, the base-station receiver code should not crash.</p>
<p>The best way to ensure our software is robust (excluding years of field operation),
is to write comprehensive tests. A common technique is end-to-end testing, which
tests a system holistically, attempting to accurately mimic real operation. This
project will involving incrementally creating test suites to validate our software.
Those working on this project may explore modeling the car's operation as a state
machine, where various effects (e.g. a cable being jostled lose) are represented
by state transitions.</p>
<h3 id="cloud-hosted-databases-and-dashboard---2-4--3-6-weeks"><a class="header" href="#cloud-hosted-databases-and-dashboard---2-4--3-6-weeks"><em>Cloud hosted databases and dashboard</em> (⭐️, 👥 2-4, 📅 3-6 weeks)</a></h3>
<p>Currently, all databases and dashboards are run locally—that is, on a member's
laptop or the Raspberry Pi. It would be nice to migrate parts of the system,
especially the code running on the base-station, to cloud environments, so
that base-station operations would never depend on someone's laptop running out
of battery, for example. Hosting our data on the cloud would also allow us to
share our dashboard on a dedicated website.</p>
<h3 id="xbee-cellular-communication---3-6--4-12-weeks"><a class="header" href="#xbee-cellular-communication---3-6--4-12-weeks"><em>XBee cellular communication</em> (⭐️, 👥 3-6, 📅 4-12 weeks)</a></h3>
<p>Currently, all communication between the solar car and the base-station occurs
over two radio transmitters. These transmitters work well enough, but are
prone to losing contact when separated too far. Last year, we purchased an
XBee cellular chip, but we have not started using it yet. This project will
involve working with a new piece of hardware to improve our system and will
likely involve working with cloud environments.</p>
<h3 id="onboard-gps-module-with-dashboard-integration---2-5--6-12-weeks"><a class="header" href="#onboard-gps-module-with-dashboard-integration---2-5--6-12-weeks"><em>Onboard GPS module with dashboard integration</em> (🌱, 👥 2-5, 📅 6-12 weeks)</a></h3>
<p>It would be nice to visualize the car's progress along the track on our dashboard.
This project will oversee the addition of a new GPS module to the car, which will
provide positioning data that must be relayed to the base-station and displayed
visually.</p>
<h3 id="onboard-front-facing-camera-with-dashboard-integration---2-5--6-12-weeks"><a class="header" href="#onboard-front-facing-camera-with-dashboard-integration---2-5--6-12-weeks"><em>Onboard front-facing camera with dashboard integration</em> (🌱, 👥 2-5, 📅 6-12 weeks)</a></h3>
<p>A similar improvement to our dashboard would be a front-facing camera that shows
the drivers perspective in the car. F1 broadcasts, for example, tend to show this
perspective. While it would be a great addition to the dashboard, members working
on this project will need to first determine whether transmitting live video data
if feasible with our hardware.</p>
<h3 id="investigating-the-energy-cost-of-the-python-runtime---1-2--4-12-weeks"><a class="header" href="#investigating-the-energy-cost-of-the-python-runtime---1-2--4-12-weeks"><em>Investigating the energy cost of the Python runtime</em> (🌱, 👥 1-2, 📅 4-12 weeks)</a></h3>
<p>Energy consumption is not a factor often considered when writing software. For our system,
however, being a battery hog is unacceptable, as all the power the onboard system uses
ultimately comes from the solar cells that power the car. Those interested in other
programming languages might investigate the energy cost of running Python on the
Raspberry Pi over a more lightweight language like C, Go, or Rust. If it turns out
the Python runtime is unacceptably inefficient for our needs (this admittedly seems
unlikely), the team could consider migrating a small part of the system to a different
language.</p>
<h3 id="running-an-onboard-repl-to-aid-debugging---1-4--3-6-weeks"><a class="header" href="#running-an-onboard-repl-to-aid-debugging---1-4--3-6-weeks"><em>Running an onboard REPL to aid debugging</em> (🌱, 👥 1-4, 📅 3-6 weeks)</a></h3>
<p>LISP was the first programming language to feature a REPL (Read, Eval, Print Loop).
In the late 90s, a team at NASA deployed LISP code running with a REPL on a Deep
Space probe. When code on the probe stopped working, engineers on Earth were able
to debug it and send it the necessary commands to fix the issue through this REPL.</p>
<p>Python, like LISP, can run with a REPL, and, like the NASA team, we stand to
benefit from accessing such an onboard REPL remotely. It would be a challenge
to figure out to set this up over XBee devices, but this project could be a
lot of fun!</p>
<h3 id="exploring-time-series-data-with-machine-learning---1-5--3-18-weeks"><a class="header" href="#exploring-time-series-data-with-machine-learning---1-5--3-18-weeks"><em>Exploring time series data with machine learning</em> (🌱, 👥 1-5, 📅 3-18 weeks)</a></h3>
<p>Analyzing CAN traffic with machine learning models could provide interesting
opportunities for racing strategy. Through this project, members interested in ML
could explore how, if at all, we could use such models to optimize our decisions
at a race.</p>
<h2 id="other-projects"><a class="header" href="#other-projects">Other projects</a></h2>
<p>Have an idea for a project that's not listed here? That's great! As long as it's
even tangentially related to the solar car, you'll be able to work on it. Software
is fortunate to be free from many of the tight deadlines and requirements Mechanical
and Electrical face (especially true during this year's design cycle), and, as a
result, we tend to have more freedom to experiment.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tritium-wavesculptor-22-motor-controller"><a class="header" href="#tritium-wavesculptor-22-motor-controller">Tritium WaveSculptor 22 Motor Controller</a></h1>
<p><img src="hardware/../images/wavesculptor22.png" alt="WaveSculptor 22" /></p>
<p>The Tritium WaveSculptor 22 is the motor drive responsible for controlling
the solar car's motors. The CAN frame specification can be found on pp.28-35
of the <a href="hardware/../pdfs/WaveSculptor22.pdf">user's manual</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prohelion-ev-driver-controls"><a class="header" href="#prohelion-ev-driver-controls">Prohelion EV Driver Controls</a></h1>
<p><img src="hardware/../images/driver-controls.webp" alt="EV Driver Controls" /></p>
<p>Prohelion's EV Driver Controls is the device responsible for controlling the
motor controllers. Details can be found in the
<a href="hardware/../hardware/driver-controls.pdf">user's manual</a>. You'll notice that the manual
does not specify the device's CAN broadcast messages. This is because, like the
BMS, this device is programmable. The current settings define the following CAN
frames:</p>
<h3 id="id-info"><a class="header" href="#id-info">ID Info</a></h3>
<p>Frame ID: Base address + 0x0</p>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Bytes</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Tritium ID</td><td>0-3</td><td><code>Uint32</code></td><td>Device identifier</td></tr>
<tr><td>Serial Number</td><td>4-7</td><td><code>Uint32</code></td><td>Device serial number, allocated at manufacture</td></tr>
</tbody></table>
</div></div>
<h3 id="drive"><a class="header" href="#drive">Drive</a></h3>
<p>Frame ID: Base address + 0x1</p>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Bytes</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Set point Motor Velocity</td><td>0-3</td><td><code>Float32</code></td><td>Desired motor velocity set point in rpm</td></tr>
<tr><td>Set point Motor Current</td><td>4-7</td><td><code>Float32</code></td><td>Desired motor current set point as a percentage of maximum current setting</td></tr>
</tbody></table>
</div></div>
<h3 id="power"><a class="header" href="#power">Power</a></h3>
<p>Frame ID: Base address + 0x2</p>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Bytes</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Reserved</td><td>0-3</td><td>-</td><td>-</td></tr>
<tr><td>Set point Bus Current</td><td>4-7</td><td><code>Float32</code></td><td>Desired set point of current drawn from the bus by the controller as a percentage of absolute bus current limit</td></tr>
</tbody></table>
</div></div>
<h3 id="reset"><a class="header" href="#reset">Reset</a></h3>
<p>Frame ID: Base address + 0x3</p>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Bytes</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Unused</td><td>0-3</td><td>-</td><td>-</td></tr>
<tr><td>Unused</td><td>4-7</td><td>-</td><td>-</td></tr>
</tbody></table>
</div></div>
<h3 id="switch"><a class="header" href="#switch">Switch</a></h3>
<p>Frame ID: Base address + 0x5</p>
<div style="display: flex; justify-content: left;">
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Bit(s)</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Mode reverse</td><td>0</td><td><code>Bool</code></td><td>Car is in reverse mode if set</td></tr>
<tr><td>Mode neutral</td><td>1</td><td><code>Bool</code></td><td>Car is in neutral mode if set</td></tr>
<tr><td>Mode regen</td><td>2</td><td><code>Bool</code></td><td>Car is regenerating power from the motor if set</td></tr>
<tr><td>Mode drive</td><td>3</td><td><code>Bool</code></td><td>Car is in drive mode if set</td></tr>
<tr><td>Ignition Accessories</td><td>4</td><td><code>Bool</code></td><td>Ignition key is in the accessories position</td></tr>
<tr><td>Ignition Run</td><td>5</td><td><code>Bool</code></td><td>Ignition key is in the run position</td></tr>
<tr><td>Ignition Start</td><td>6</td><td><code>Bool</code></td><td>Ignition key is in the start position</td></tr>
<tr><td>Brake</td><td>7</td><td><code>Bool</code></td><td>Brake pedal is currently being pressed if set</td></tr>
<tr><td>Charge Port</td><td>8</td><td><code>Bool</code></td><td>Charge port is currently open if set; port must be closed for car to drive</td></tr>
<tr><td>Unused</td><td>9-40</td><td>-</td><td>-</td></tr>
<tr><td>Flags</td><td>48-55</td><td><code>Uint8</code></td><td>Flags currently being reported by the Driver Controller (check the code for more details)</td></tr>
<tr><td>State</td><td>56-63</td><td><code>Uint8</code></td><td>Latest state as being reported by the Driver Controller (check the code for more detail on valid states)</td></tr>
</tbody></table>
</div></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elmar-solar-mppt"><a class="header" href="#elmar-solar-mppt">Elmar Solar MPPT</a></h1>
<p><img src="hardware/../images/mppt.png" alt="MPPT" /></p>
<p>The Elmar Solar MPPTs are responsible for managing power drawn from
the solar cells on the car. The CAN frame specification can be found
on pp.6-7 of the <a href="hardware/../pdfs/mppt.pdf">datasheet</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
